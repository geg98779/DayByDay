## scheme协议
scheme（也常称为 URI scheme 或 URL 方案）指的是 URL 中最前面的部分，用于标识访问资源的协议类型。它是 URL 的 “开头标识”，告诉浏览器或客户端 “用什么方式获取这个资源”。
通俗理解
比如在 URL https://www.example.com 中，https 就是 scheme；在 ftp://ftp.example.com/file.zip 中，ftp 就是 scheme。

## 新版消息队列 宏队列已被弃用
根据最新的W3C和WHATWG（Web超文本应用技术工作组）规范，W3C已不再使用“宏队列”这一术语。以下是关键点的总结与分析：

1. 术语的演变
早期的JavaScript事件循环模型中，任务队列常被简化为“宏队列”和“微队列”两类。然而，随着浏览器功能的复杂化，简单的分类已无法满足需求。根据WHATWG的HTML标准（最新更新于2023年6月），事件循环包含多个任务队列，每个队列对应不同类型的任务（如用户交互、网络请求、定时器等），而“微队列”仅作为其中一种特殊的高优先级队列存在。
2. 当前规范中的任务队列分类
微任务队列（Microtask Queue）：优先级最高，用于存放Promise.then、MutationObserver等回调任务，必须在一个事件循环周期内清空。
交互队列（Interaction Queue）：处理用户操作（如点击、输入事件），优先级次高，确保快速响应。
延时队列（Delay Queue）：存放setTimeout、setInterval回调，优先级中等。
其他队列：如网络请求队列、渲染任务队列等，具体由浏览器实现决定。
3. 事件循环的调度逻辑
事件循环的工作流程如下：
执行同步代码：主线程直接处理全局同步任务。
清空微任务队列：每次执行完一个任务后，优先处理所有微任务。
按优先级选择其他队列：依次处理交互队列、延时队列等，不同队列的优先级由浏览器自行决定，但需避免“进程饿死”。
4. “宏队列”概念的替代
W3C和浏览器厂商不再将非微任务队列统一称为“宏队列”，而是根据任务类型细分为多个独立队列。例如：
定时器任务属于延时队列。
用户点击事件属于交互队列。
网络请求回调可能属于独立的I/O队列。
5. 规范引用与浏览器实现
WHATWG标准明确表示，事件循环必须有一个微任务队列，但其他任务队列的数量和类型由浏览器自行定义。
例如，Chrome浏览器实现了微队列、交互队列、延时队列等，且交互队列的优先级高于延时队列。

## 为啥chrome源码要限制计时器嵌套大于五层强制设置4ms延迟？
无限嵌套 setTimeout(fn, 0) 如果没有最小延迟限制，会对主线程造成严重影响，而设置成 4 毫秒，其实是一种对主线程的保护机制，并非让情况变得更糟，以下是具体原因：
无限嵌套 setTimeout(fn, 0) 对主线程的影响
频繁进入宏任务队列：setTimeout 的回调函数属于宏任务，setTimeout(fn, 0) 虽然设置的延迟时间为 0，但并不是立即执行回调函数，而是会把回调函数放入宏任务队列中。在无限嵌套的情况下，会快速且不断地往宏任务队列中添加回调任务。
阻塞主线程：JavaScript 是单线程语言，主线程需要处理调用栈中的同步任务，以及从宏任务队列和微任务队列中按规则取出的任务。当宏任务队列被无限嵌套的 setTimeout 回调填满时，只要调用栈清空，事件循环就会不断地从宏任务队列中取出这些回调任务放入调用栈执行。这就使得主线程一直处于忙碌状态，无法及时处理其他任务，比如用户交互（点击、输入等）、DOM 渲染更新 ，从而导致页面失去响应，出现卡顿甚至卡死的现象。而且，如果有其他重要的宏任务（比如网络请求的回调）进入队列，也会被这些无限嵌套的 setTimeout 回调阻塞，无法及时执行。
设置 4 毫秒最小延迟的意义
避免过度占用主线程：设置 4 毫秒的最小延迟后，即便存在无限嵌套的 setTimeout，每个回调任务之间至少会有 4 毫秒的间隔，这就给了主线程喘息的机会。在这 4 毫秒内，主线程有时间去处理其他紧急任务，比如响应用户的点击事件，进行必要的 DOM 渲染更新等，避免主线程被无限嵌套的 setTimeout 回调持续霸占而无法处理其他重要事务。
平衡性能和响应性：从性能角度看，虽然 4 毫秒的延迟在一定程度上会让 setTimeout 回调的执行速度变慢，但却保障了浏览器的整体性能和用户体验。它防止了恶意代码或者不合理的代码通过无限嵌套 setTimeout 来拖垮主线程，确保了浏览器在面对这类情况时，仍能维持基本的交互响应和页面渲染功能，不会出现完全卡死无响应的状态。
限制任务添加频率：4 毫秒的间隔限制了宏任务队列中 setTimeout 回调任务的添加频率，使得宏任务队列不会在短时间内被无限量地填充，从而保证了事件循环机制能够相对正常地运行，合理调度各类任务。

简单来说，无限嵌套 setTimeout(fn, 0) 不加限制会严重影响主线程的正常工作，而设置 4 毫秒最小延迟，是在保护主线程、保障浏览器整体性能和用户体验方面做出的权衡，避免主线程被过度占用导致浏览器失去响应。