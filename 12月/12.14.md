## zustand && chunks
```ts
 // ä» Zustand åº“ä¸­å¯¼å…¥ createï¼Œç”¨äºåˆ›å»ºçŠ¶æ€ç®¡ç† store
        import { create } from 'zustand'

        // å¯¼å…¥å¦ä¸€ä¸ª storeï¼Œç”¨äºè·å–å½“å‰é€‰ä¸­çš„ä¼šè¯ ID
        import { useConversationStore } from './useConversationStore'

        // å¯¼å…¥ç±»å‹å®šä¹‰ï¼ˆæ¶ˆæ¯å†…å®¹ç±»å‹ã€è§’è‰²ç±»å‹ï¼‰
        import type { MessageContent } from '@pc/types/chat'
        import type { Role } from '@pc/types/common'

        // å®šä¹‰å•æ¡æ¶ˆæ¯çš„ç»“æ„
        export type MessageProps = {
            content: MessageContent[] // æ¶ˆæ¯å†…å®¹ï¼ˆå…¼å®¹æ—§æ ¼å¼ï¼‰
            role: Role                // æ¶ˆæ¯å‘é€è€…çš„è§’è‰²ï¼Œä¾‹å¦‚ "user"ã€"system" ç­‰
        }

        // å®šä¹‰æ•´ä¸ªèŠå¤©æ¶ˆæ¯çš„ç»“æ„ï¼š
        // Map çš„ key æ˜¯ä¼šè¯ ID (string)ï¼Œvalue æ˜¯è¯¥ä¼šè¯çš„æ‰€æœ‰æ¶ˆæ¯æ•°ç»„
        export type ChatMessageProps = Map<string, MessageProps[]>

        // å®šä¹‰ Store çš„æ•°æ®ç»“æ„ä¸æ–¹æ³•
        export interface ChatStoreProps {
            messages: ChatMessageProps                    // æ‰€æœ‰ä¼šè¯çš„æ¶ˆæ¯é›†åˆ
            addMessage: ({ content, role }: MessageProps) => void  // æ·»åŠ æ–°æ¶ˆæ¯
            addChunkMessage: (chunk: string) => void               // åˆ†å—è¿½åŠ æ¶ˆæ¯å†…å®¹ï¼ˆæµå¼ï¼‰
        }

        // åˆ›å»º Zustand Store
        export const useChatStore = create < ChatStoreProps > ((set) => ({
            // åˆå§‹çŠ¶æ€ï¼šç©ºçš„ Map
            messages: new Map(),

            // ğŸŸ© æ·»åŠ ä¸€æ¡å®Œæ•´æ¶ˆæ¯ï¼ˆå¦‚ç”¨æˆ·æˆ–ç³»ç»Ÿçš„å®Œæ•´ä¸€å¥è¯ï¼‰
            addMessage: ({ content, role }: MessageProps) => {
                // ä»ä¼šè¯ Store ä¸­è·å–å½“å‰é€‰ä¸­çš„ä¼šè¯ ID
                const { selectedId } = useConversationStore.getState()

                // ä½¿ç”¨ set() æ›´æ–°çŠ¶æ€
                set((state) => ({
                    // æ›´æ–° messages
                    messages: state.messages.set(selectedId as string, [
                        // å–å‡ºå½“å‰é€‰ä¸­ä¼šè¯çš„å†å²æ¶ˆæ¯ï¼ˆæ²¡æœ‰åˆ™ä¸ºç©ºæ•°ç»„ï¼‰
                        ...(state.messages.get(selectedId as string) || []),
                        // è¿½åŠ æ–°æ¶ˆæ¯å¯¹è±¡
                        { content, role }
                    ])
                }))
            },

            // ğŸŸ¦ æ·»åŠ æ¶ˆæ¯ç‰‡æ®µï¼ˆchunkï¼‰â€”â€” ç”¨äºåƒ ChatGPT é‚£ç§æµå¼è¾“å‡º
            addChunkMessage: (chunk: string) => {
                // è·å–å½“å‰é€‰ä¸­çš„ä¼šè¯ ID
                const { selectedId } = useConversationStore.getState()

                // æ›´æ–°çŠ¶æ€
                set((state) => {
                    // å–å‡ºå½“å‰ä¼šè¯çš„æ¶ˆæ¯æ•°ç»„ï¼ˆæ²¡æœ‰åˆ™ä¸ºç©ºï¼‰
                    const currentMessages = state.messages.get(selectedId as string) || []
                    // è·å–æœ€åä¸€æ¡æ¶ˆæ¯
                    const lastMessage = currentMessages[currentMessages.length - 1]

                    // å¦‚æœæœ€åä¸€æ¡æ˜¯ç³»ç»Ÿæ¶ˆæ¯ï¼ˆsystemï¼‰ï¼Œåˆ™è¿½åŠ å†…å®¹
                    if (lastMessage && lastMessage.role === 'system') {
                        // è·å–è¯¥æ¶ˆæ¯çš„å†…å®¹æ•°ç»„
                        const lastContent = lastMessage.content
                        // å–å‡ºæœ€åä¸€æ®µå†…å®¹ï¼ˆå¯èƒ½æ˜¯æ–‡æœ¬ï¼‰
                        const lastTextContent = lastContent[lastContent.length - 1]

                        // å¦‚æœæœ€åä¸€æ®µå†…å®¹æ˜¯æ–‡æœ¬ç±»å‹ï¼Œåˆ™ç›´æ¥åœ¨å…¶åè¿½åŠ  chunk
                        if (lastTextContent && lastTextContent.type === 'text') {
                            lastTextContent.content += chunk
                        }
                    } else {
                        // å¦åˆ™ï¼Œæ–°å»ºä¸€æ¡ç³»ç»Ÿæ¶ˆæ¯å¹¶æ”¾å…¥ currentMessages
                        currentMessages.push({
                            content: [
                                {
                                    type: 'text',
                                    content: chunk
                                }
                            ],
                            role: 'system'
                        })
                    }

                    // æ›´æ–°çŠ¶æ€ä¸­çš„ messages Mapï¼ˆæŒ‰ä¼šè¯ ID å­˜ï¼‰
                    return {
                        messages: state.messages.set(selectedId as string, currentMessages)
                    }
                })
            }
        }))
```