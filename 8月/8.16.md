## V8 核心原理
1. 什么是 V8 引擎？
V8 是一个由 Google 开发的开源 JavaScript 引擎，它用 C++ 编写。V8 的主要任务是将我们写的 JavaScript 代码转换成计算机能够理解和执行的机器码。它不依赖于任何解释器，直接编译执行，这使得它的性能非常高。

V8 不仅用于 Chrome 浏览器，也是 Node.js 的核心，因此理解它对前端和后端开发者都非常重要。

2. V8 引擎是如何工作的？
V8 的核心工作流程可以概括为：解析 -> 编译（解释）-> 优化 -> 执行。它采用了一种称为**即时编译（JIT）**的混合模式，巧妙地平衡了编译速度和执行效率。

V8 的工作流程主要由两个核心组件协同完成：

Ignition 解释器：负责快速生成和执行字节码。当代码第一次运行时，Ignition 会迅速将代码编译成字节码并执行，这比直接编译成机器码要快得多。同时，Ignition 在执行过程中会收集代码的性能数据。

TurboFan 优化编译器：如果 Ignition 发现某段代码（比如一个函数）被频繁调用，它会标记这段代码为**“热点代码”。这时，V8 会把字节码和收集到的类型信息发送给 TurboFan。TurboFan 会将这段字节码编译成高度优化的机器码，这个过程包括内联**、死代码消除等技术，以达到极致的执行效率。

这个过程就像一个流水线：Ignition 快速启动程序，而 TurboFan 则在后台悄悄地优化热点代码，从而在不影响程序启动速度的前提下提升整体性能。

3. 什么是“反优化”？
V8 的优化是基于乐观假设的。例如，TurboFan 可能会假设某个函数的参数类型总是整数，然后根据这个假设进行优化编译。

如果这个假设在后续执行中被打破（例如，突然传入一个字符串），之前编译好的机器码就会失效。这时，V8 会立即将执行权交还给 Ignition 解释器，重新执行字节码。这个过程就是反优化（Deoptimization）。

反优化的存在确保了 V8 在面对类型变化时依然能够正确运行，但它也会带来一定的性能开销。

4. V8 的垃圾回收机制是什么？
V8 采用分代回收的策略来管理内存。它将内存分为两个主要区域：

新生代（Young Generation）：用于存放新创建的对象，这些对象的生命周期通常很短。新生代采用 Scavenger 算法进行回收，这是一种高效的复制算法。它将存活的对象从一个空间（From Space）复制到另一个空闲的空间（To Space），然后直接清空旧空间。

老生代（Old Generation）：用于存放从新生代晋升的存活时间较长的对象。老生代使用 **Mark-Sweep-Compact（标记-清除-整理）**算法进行回收。

标记（Marking）：标记所有活动对象。

清除（Sweeping）：清除未标记的非活动对象。

整理（Compacting）：移动存活对象以消除内存碎片。

这种分代回收策略显著减少了垃圾回收的总体时间，因为它不需要频繁地扫描整个内存空间，只需对新生代进行快速回收即可。